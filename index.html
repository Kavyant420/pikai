<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PikAI - Advanced Cybersecurity AI</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 320 512'><path fill='%23ff6b6b' d='M296 160H180.6L212.1 16.4c2.5-12.1-10.3-20.6-20.4-12.8L24 192c-7.1 5.7-3.3 17.6 6 17.6h115.4L107.9 495.6c-2.5 12.1 10.3 20.6 20.4 12.8l168-128c7.1-5.7 3.3-17.6-6-17.6H174.9l32.5-143.6c2.5-12.1-10.3-20.6-20.4-12.8L296 160z'/></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <style>
        :root {
            --primary-bg: #000000;
            --secondary-bg: #0a0a0a;
            --tertiary-bg: #151515;
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --accent-color: #ff6b6b;
            --accent-secondary: #4ecdc4;
            --glow-color: rgba(255, 107, 107, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: var(--primary-bg);
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            z-index: 100;
            transition: var(--transition);
        }

        .menu-icon {
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition);
            color: var(--text-primary);
        }

        .menu-icon:hover {
            background: var(--tertiary-bg);
            color: var(--accent-color);
            transform: scale(1.05);
        }

        .model-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 12px;
            transition: var(--transition);
            border: 1px solid var(--border-color);
            background: var(--secondary-bg);
        }

        .model-selector:hover {
            background: var(--tertiary-bg);
            border-color: var(--accent-color);
            box-shadow: 0 0 20px var(--glow-color);
        }

        .model-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .dropdown-arrow {
            font-size: 12px;
            transition: var(--transition);
            color: var(--text-secondary);
        }

        .user-icon {
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
            color: var(--text-primary);
        }

        .user-icon:hover {
            background: var(--tertiary-bg);
            color: var(--accent-color);
            transform: scale(1.05);
        }

        /* Enhanced Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: -400px;
            width: 400px;
            height: 100vh;
            background: linear-gradient(145deg, var(--secondary-bg), var(--primary-bg));
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-color);
            z-index: 2000;
            transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            background: var(--tertiary-bg);
        }

        .sidebar-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition);
            margin-left: auto;
        }

        .close-btn:hover {
            background: var(--border-color);
            color: var(--accent-color);
            transform: rotate(90deg);
        }

        .sidebar-nav {
            flex: 1;
            padding: 0;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 24px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            color: var(--text-secondary);
        }

        .nav-item:hover, .nav-item.active {
            background: var(--tertiary-bg);
            color: var(--text-primary);
            border-left-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.1);
        }

        .nav-item i {
            font-size: 20px;
            width: 24px;
        }

        .nav-item span {
            font-weight: 500;
            font-size: 16px;
        }

        .sidebar-content {
            padding: 24px;
            flex: 1;
            overflow-y: auto;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .system-prompt-editor {
            background: var(--tertiary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            color: var(--text-primary);
            font-family: 'Inter', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            min-height: 200px;
            width: 100%;
            transition: var(--transition);
        }

        .system-prompt-editor:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 20px var(--glow-color);
        }

        .history-item, .project-item, .library-item {
            background: var(--tertiary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .history-item:hover, .project-item:hover, .library-item:hover {
            background: var(--secondary-bg);
            border-color: var(--accent-color);
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.1);
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            background: radial-gradient(circle at center, rgba(255, 107, 107, 0.05) 0%, transparent 70%);
        }

        .greeting {
            text-align: center;
            margin-bottom: 40px;
        }

        .greeting-text {
            font-size: 28px;
            font-weight: 300;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .username {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .capability-tags {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 40px 0;
        }

        .capability-tag {
            background: var(--tertiary-bg);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .capability-tag.active {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        /* Enhanced Chat Container */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }

        .message {
            max-width: 85%;
            padding: 16px 20px;
            border-radius: 20px;
            line-height: 1.6;
            position: relative;
            font-size: 15px;
            transition: var(--transition);
        }

        /* Enhanced User Message Styling */
        .user-message {
            background: var(--primary-bg);
            border: 2px solid var(--text-primary);
            color: var(--text-primary);
            align-self: flex-end;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
            font-weight: 500;
        }

        .bot-message {
            background: var(--secondary-bg);
            color: var(--text-primary);
            align-self: flex-start;
            border-radius: 20px;
            border: 1px solid var(--border-color);
        }

        /* Enhanced Search Indicator */
        .search-indicator {
            display: none;
            background: linear-gradient(135deg, var(--tertiary-bg), var(--secondary-bg));
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 20px;
            margin: 10px 0;
            align-self: flex-start;
            max-width: 85%;
        }

        .search-indicator.active {
            display: block;
            animation: searchPulse 2s infinite ease-in-out;
        }

        @keyframes searchPulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
                border-color: rgba(255, 107, 107, 0.5);
            }
            50% {
                box-shadow: 0 0 40px rgba(255, 107, 107, 0.6);
                border-color: var(--accent-color);
            }
        }

        .search-text {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            color: var(--accent-color);
        }

        .search-spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 107, 107, 0.3);
            border-top: 3px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Code Blocks */
        .code-container {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin: 16px 0;
            overflow: hidden;
            position: relative;
        }

        .code-header {
            background: var(--tertiary-bg);
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: between;
            align-items: center;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .code-language {
            font-weight: 600;
            color: var(--accent-color);
        }

        .copy-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: var(--transition);
            margin-left: auto;
        }

        .copy-btn:hover {
            background: var(--accent-secondary);
            transform: scale(1.05);
        }

        pre {
            background: transparent !important;
            padding: 20px;
            margin: 0;
            overflow-x: auto;
            font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Enhanced Input Container */
        
        .input-container {
            width: 95%;
            max-width: 900px;
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 25px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: sticky;
            bottom: 20px;
            margin: 20px auto;
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .input-container:focus-within {
            border-color: var(--accent-color);
            box-shadow: 0 0 30px var(--glow-color);
        }

        .input-field {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            padding: 8px 0;
            outline: none;
        }

        .input-field::placeholder {
            color: var(--text-secondary);
        }

        .input-icons {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-btn, .send-border {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--tertiary-bg);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-primary);
        }

        .add-btn:hover, .send-border:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--glow-color);
        }

        .send-counter {
            position: absolute;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 12px;
            color: var(--text-primary);
            opacity: 0;
            transition: var(--transition);
        }

        .send-counter.active {
            opacity: 1;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 12px;
            padding: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--tertiary-bg);
            border: 1px solid var(--border-color);
            padding: 12px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
            font-weight: 500;
        }

        .action-btn:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        /* Overlay and Popup */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 1;
            transition: var(--transition);
        }

        .overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .popup {
            background: linear-gradient(135deg, var(--secondary-bg), var(--tertiary-bg));
            border: 1px solid var(--border-color);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            transform: scale(1);
            transition: var(--transition);
            max-width: 400px;
            width: 90%;
        }

        .popup.hidden {
            transform: scale(0.9);
            opacity: 0;
        }

        .popup h2 {
            margin-bottom: 24px;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .popup input {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--tertiary-bg);
            color: var(--text-primary);
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            margin-bottom: 24px;
            transition: var(--transition);
        }

        .popup input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 20px var(--glow-color);
        }

        .popup button {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
        }

        .popup button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.4);
        }

        /* File Upload */
        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: var(--transition);
            background: var(--tertiary-bg);
        }

        .file-upload-area:hover, .file-upload-area.dragover {
            border-color: var(--accent-color);
            background: rgba(255, 107, 107, 0.05);
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.2);
        }

        .file-chip {
            background: var(--tertiary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 8px 16px;
            margin: 4px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            transition: var(--transition);
        }

        .file-chip:hover {
            background: var(--secondary-bg);
            border-color: var(--accent-color);
        }

        .remove-btn {
            cursor: pointer;
            color: var(--accent-color);
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .remove-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        /* Scroll to top */
        .scroll-to-top {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            color: white;
            font-size: 20px;
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.4);
            transition: var(--transition);
        }

        .scroll-to-top:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                left: -100%;
            }

            .header {
                padding: 12px 16px;
            }

            .greeting-text {
                font-size: 22px;
            }

            .username {
                font-size: 28px;
            }

            .message {
                max-width: 95%;
                padding: 12px 16px;
            }

            .input-container {
                width: 95%;
                padding: 8px 16px;
            }

            .capability-tags {
                gap: 8px;
            }

            .capability-tag {
                padding: 6px 12px;
                font-size: 13px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--primary-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }

        /* Hide elements */
        .hidden-file-input {
            display: none;
        }

        /* Additional Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message {
            animation: fadeInUp 0.3s ease-out;
        }

        /* Enhanced Typing Indicator */
        .typing-indicator {
            display: none;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            padding: 16px 20px;
            border-radius: 20px;
            align-self: flex-start;
            margin: 10px 0;
            max-width: 200px;
        }

        .typing-indicator.active {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            display: block;
            width: 8px;
            height: 8px;
            background: var(--accent-color);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typingBounce {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
    </style>
</head>
<body>
    <!-- Name Prompt Overlay -->
    <div class="overlay" id="popupOverlay">
        <div class="popup" id="popupBox">
            <h2>Welcome to PikAI</h2>
            <input type="text" id="username" placeholder="Enter your name">
            <button onclick="submitName()">Get Started</button>
        </div>
    </div>
    
    <!-- Enhanced Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">PikAI Menu</div>
            <button class="close-btn" id="closeSidebar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="sidebar-nav">
            <div class="nav-item active" data-section="system-prompt">
                <i class="fas fa-cog"></i>
                <span>System Prompt</span>
            </div>
            <div class="nav-item" data-section="history">
                <i class="fas fa-history"></i>
                <span>Chat History</span>
            </div>
            <div class="nav-item" data-section="projects">
                <i class="fas fa-folder-open"></i>
                <span>Projects</span>
            </div>
            <div class="nav-item" data-section="library">
                <i class="fas fa-book"></i>
                <span>Library</span>
            </div>
        </div>
        
        <div class="sidebar-content">
            <div class="content-section active" id="system-prompt-section">
                <h3 style="margin-bottom: 16px; color: var(--accent-color);">System Prompt</h3>
                <textarea class="system-prompt-editor" id="systemPromptEditor" 
                    placeholder="Define how PikAI should behave...">You are PikAI, an advanced cybersecurity AI assistant with expertise in penetration testing, vulnerability assessment, network security, malware analysis, digital forensics, incident response, and ethical hacking. You provide comprehensive security guidance while emphasizing ethical practices and legal compliance. You assist security professionals with technical analysis, threat intelligence, and defensive strategies.</textarea>
                <button onclick="updateSystemPrompt()" style="margin-top: 12px; background: var(--accent-color); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer;">Update Prompt</button>
            </div>
            
            <div class="content-section" id="history-section">
                <h3 style="margin-bottom: 16px; color: var(--accent-color);">Chat History</h3>
                <div id="historyList">
                    <div class="history-item">
                        <div style="font-weight: 600; margin-bottom: 8px;">Today</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">No conversations yet</div>
                    </div>
                </div>
            </div>
            
            <div class="content-section" id="projects-section">
                <h3 style="margin-bottom: 16px; color: var(--accent-color);">Projects</h3>
                <div id="projectsList">
                    <div class="project-item">
                        <div style="font-weight: 600; margin-bottom: 8px;">Penetration Testing Report</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">Security assessment documentation</div>
                    </div>
                    <div class="project-item">
                        <div style="font-weight: 600; margin-bottom: 8px;">Vulnerability Scanner</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">Custom security tools</div>
                    </div>
                </div>
            </div>
            
            <div class="content-section" id="library-section">
                <h3 style="margin-bottom: 16px; color: var(--accent-color);">Security Library</h3>
                <div id="libraryList">
                    <div class="library-item">
                        <div style="font-weight: 600; margin-bottom: 8px;">OWASP Top 10</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">Web application security risks</div>
                    </div>
                    <div class="library-item">
                        <div style="font-weight: 600; margin-bottom: 8px;">NIST Framework</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">Cybersecurity guidelines</div>
                    </div>
                    <div class="library-item">
                        <div style="font-weight: 600; margin-bottom: 8px;">CVE Database</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">Common vulnerabilities</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Header -->
    <div class="header">
        <div class="menu-icon" id="menuIcon">
            <i class="fas fa-bars"></i>
        </div>
        <div class="model-selector">
            <span class="model-name" id="currentModel">PikAI-CyberSec</span>
            <i class="fas fa-chevron-down dropdown-arrow"></i>
        </div>
        <div class="user-icon">
            <i class="fas fa-shield-alt"></i>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="greeting">
            <div class="greeting-text" id="greetingText">Good evening,</div>
            <div class="username" id="usernameDisplay">CyberSec Professional</div>
        </div>
        
        <div class="capability-tags">
            <div class="capability-tag active">Penetration Testing</div>
            <div class="capability-tag active">Vulnerability Assessment</div>
            <div class="capability-tag active">Malware Analysis</div>
            <div class="capability-tag active">Network Security</div>
            <div class="capability-tag active">Digital Forensics</div>
            <div class="capability-tag active">Incident Response</div>
        </div>
    </div>
    
    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer" style="display: none;">
        <div class="message bot-message">
            <div style="margin-bottom: 12px;">
                <i class="fas fa-shield-alt" style="color: var(--accent-color); margin-right: 8px;"></i>
                <strong>PikAI Cybersecurity Assistant Ready</strong>
            </div>
            Hello! I'm PikAI, your advanced cybersecurity AI assistant. I specialize in:
            <br><br>
            â€¢ <strong>Penetration Testing</strong> - Ethical hacking methodologies and tools<br>
            â€¢ <strong>Vulnerability Assessment</strong> - Security weakness identification<br>
            â€¢ <strong>Malware Analysis</strong> - Threat detection and reverse engineering<br>
            â€¢ <strong>Network Security</strong> - Infrastructure hardening and monitoring<br>
            â€¢ <strong>Digital Forensics</strong> - Incident investigation and evidence analysis<br>
            â€¢ <strong>Threat Intelligence</strong> - Current attack vectors and defensive strategies<br>
            <br>
            How can I assist with your cybersecurity needs today?
        </div>
    </div>
    
    <!-- Enhanced Typing Indicator -->
    <div class="typing-indicator" id="typingIndicator">
        <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <span style="color: var(--text-secondary);">PikAI is thinking...</span>
    </div>
    
    <!-- Enhanced Search Indicator -->
    <div class="search-indicator" id="searchIndicator">
        <div class="search-text">
            <div class="search-spinner"></div>
            <span id="searchText">Searching...</span>
        </div>
    </div>
    
    <!-- File Upload Area -->
    <div class="file-upload-area" id="fileUploadArea" style="display: none;">
        <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--accent-color); margin-bottom: 16px;"></i>
        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Drop files here or click to upload</div>
        <div style="font-size: 14px; color: var(--text-secondary);">
            Supports: Images, PDFs, Text files, Audio, Video, Documents, Log files
        </div>
    </div>
    
    <div class="uploaded-files" id="uploadedFiles"></div>
    
    <!-- Enhanced Input Container -->
    <div class="input-container">
        <input type="file" id="hiddenFileInput" class="hidden-file-input" multiple accept="*/*">
        <input type="text" class="input-field" id="userInput" 
               placeholder="Ask about security vulnerabilities, analyze malware, or request penetration testing guidance...">
        
        <div class="input-icons">
            <div class="add-btn" id="fileUploadBtn">
                <i class="fas fa-paperclip"></i>
            </div>
            <div class="send-border" id="sendButton">
                <i class="fas fa-paper-plane" id="sendIcon"></i>
                <span class="send-counter" id="sendCounter">0.0</span>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    
    
    <!-- Scroll to Top -->
    <div class="scroll-to-top" id="scrollToTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script>
        class AdvancedPikAI {
            constructor() {
                this.systemPrompt = "You are PikAI, an advanced cybersecurity AI assistant with expertise in penetration testing, vulnerability assessment, network security, malware analysis, digital forensics, incident response, and ethical hacking. You provide comprehensive security guidance while emphasizing ethical practices and legal compliance.";
                this.currentUsername = "CyberSec Professional";
                this.chatHistory = [];
                this.uploadedFiles = [];
                this.currentModel = 'cybersec-advanced';
                this.isProcessing = false;
                this.maxFileSize = 100 * 1024 * 1024; // 100MB
                this.searchSteps = [
                    'Initializing secure connection...',
                    'Querying threat intelligence databases...',
                    'Analyzing security indicators...',
                    'Cross-referencing vulnerability data...',
                    'Compiling security assessment...'
                ];
                
                // Enhanced intent patterns for cybersecurity
                this.intentPatterns = {
                    vulnerabilityAssessment: [
                        /vulnerability|vuln|cve|exploit|weakness|flaw/i,
                        /security.*scan|pentest|penetration.*test/i,
                        /assess.*security|security.*assessment/i
                    ],
                    malwareAnalysis: [
                        /malware|virus|trojan|ransomware|rootkit/i,
                        /analyze.*malware|reverse.*engineer/i,
                        /suspicious.*file|threat.*analysis/i
                    ],
                    networkSecurity: [
                        /network.*security|firewall|ids|ips/i,
                        /packet.*analysis|network.*monitor/i,
                        /intrusion.*detection|network.*hardening/i
                    ],
                    forensics: [
                        /forensic|investigation|evidence|incident/i,
                        /log.*analysis|timeline|artifact/i,
                        /digital.*forensic|cyber.*investigation/i
                    ],
                    threatIntel: [
                        /threat.*intelligence|ioc|indicator/i,
                        /apt|advanced.*persistent|attack.*vector/i,
                        /threat.*landscape|security.*news/i
                    ],
                    codeAudit: [
                        /code.*review|security.*audit|static.*analysis/i,
                        /secure.*coding|code.*vulnerability/i,
                        /source.*code.*analysis/i
                    ],
                    imageGeneration: [
                        /create.*image|generate.*image|draw|design/i,
                        /diagram|flowchart|network.*topology/i,
                        /visual|illustration|infographic/i
                    ],
                    webSearch: [
                        /search|find|lookup|research|investigate/i,
                        /latest.*threat|recent.*attack|current.*vulnerability/i,
                        /security.*news|breach.*report/i
                    ]
                };
                
                this.init();
            }

            async init() {
                this.setupEventListeners();
                this.loadUserSettings();
                this.updateGreeting();
                this.setupFileUpload();
                this.setupSidebar();
                await this.loadCyberSecModels();
            }

            setupEventListeners() {
                // Menu and sidebar
                document.getElementById('menuIcon')?.addEventListener('click', () => this.toggleSidebar());
                document.getElementById('closeSidebar')?.addEventListener('click', () => this.closeSidebar());
                
                // Navigation items
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', () => this.switchSection(item.dataset.section));
                });

                // Send message
                document.getElementById('sendButton')?.addEventListener('click', () => this.handleUserMessage());
                document.getElementById('userInput')?.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.handleUserMessage();
                    }
                });

                // Quick actions
                document.getElementById('searchBtn')?.addEventListener('click', () => this.triggerWebSearch());
                document.getElementById('vulnerabilityBtn')?.addEventListener('click', () => this.triggerVulnerabilityAssessment());
                document.getElementById('imageGenBtn')?.addEventListener('click', () => this.triggerImageGeneration());
                document.getElementById('malwareBtn')?.addEventListener('click', () => this.triggerMalwareAnalysis());

                // File upload
                document.getElementById('fileUploadBtn')?.addEventListener('click', () => document.getElementById('hiddenFileInput')?.click());
                document.getElementById('hiddenFileInput')?.addEventListener('change', (e) => this.handleFileUpload(e));

                // Drag and drop
                this.setupDragAndDrop();

                // Scroll to top
                document.getElementById('scrollToTop')?.addEventListener('click', () => this.scrollToTop());

                // Close sidebar on outside click
                document.addEventListener('click', (e) => {
                    const sidebar = document.getElementById('sidebar');
                    const menuIcon = document.getElementById('menuIcon');
                    if (!sidebar.contains(e.target) && !menuIcon.contains(e.target) && sidebar.classList.contains('active')) {
                        this.closeSidebar();
                    }
                });
            }

            setupSidebar() {
                // Load sidebar content from localStorage
                this.loadSidebarData();
            }

            toggleSidebar() {
                document.getElementById('sidebar').classList.add('active');
            }

            closeSidebar() {
                document.getElementById('sidebar').classList.remove('active');
            }

            switchSection(section) {
                // Update navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-section="${section}"]`).classList.add('active');

                // Update content
                document.querySelectorAll('.content-section').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${section}-section`).classList.add('active');
            }

            async loadCyberSecModels() {
                // Simulate loading specialized cybersecurity models
                this.availableModels = {
                    'cybersec-advanced': { capabilities: ['vulnerability', 'malware', 'forensics'] },
                    'pentest-specialist': { capabilities: ['penetration_testing', 'exploit_dev'] },
                    'threat-intel': { capabilities: ['threat_analysis', 'ioc_analysis'] },
                    'secure-code': { capabilities: ['code_audit', 'secure_dev'] }
                };
            }

            detectIntent(message) {
                const results = [];
                const text = message.toLowerCase();
                
                // Check for cybersecurity-specific intents
                Object.entries(this.intentPatterns).forEach(([intent, patterns]) => {
                    let matchCount = 0;
                    
                    patterns.forEach(pattern => {
                        if (pattern.test(text)) {
                            matchCount++;
                        }
                    });
                    
                    if (matchCount > 0) {
                        const confidence = Math.min(0.95, matchCount / patterns.length + 0.3);
                        results.push({
                            intent,
                            confidence,
                            reason: `Cybersecurity pattern matched: ${matchCount} indicators`
                        });
                    }
                });

                // Sort by confidence
                results.sort((a, b) => b.confidence - a.confidence);
                
                return results.length > 0 ? results : [{
                    intent: 'general',
                    confidence: 0.5,
                    reason: 'General cybersecurity inquiry'
                }];
            }

            selectOptimalModel(intents) {
                const primaryIntent = intents[0];
                
                const modelMapping = {
                    vulnerabilityAssessment: "pentest-specialist",
                    malwareAnalysis: "threat-intel",
                    networkSecurity: "cybersec-advanced",
                    forensics: "cybersec-advanced",
                    threatIntel: "threat-intel",
                    codeAudit: "secure-code",
                    imageGeneration: "flux",
                    webSearch: "searchgpt",
                    general: "cybersec-advanced"
                };

                const selectedModel = modelMapping[primaryIntent.intent] || 'cybersec-advanced';
                document.getElementById('currentModel').textContent = `PikAI-${selectedModel}`;
                
                return selectedModel;
            }

            async handleUserMessage() {
                const userInput = document.getElementById('userInput');
                const message = userInput.value.trim();
                
                if (!message && this.uploadedFiles.length === 0) return;
                if (this.isProcessing) return;

                this.isProcessing = true;
                this.startProcessingTimer();
                const startTime = performance.now();

                // Show chat interface
                this.showChatInterface();

                // Add user message with enhanced styling
                if (message) {
                    this.addMessage(message, true);
                    this.saveToHistory(message, 'user');
                }

                userInput.value = '';

                try {
                    // Detect intent
                    const intents = this.detectIntent(message);
                    const primaryIntent = intents[0];
                    
                    // Select optimal model
                    const selectedModel = this.selectOptimalModel(intents);
                    
                    let response = '';

                    // Process based on intent
                    switch (primaryIntent.intent) {
                        case 'vulnerabilityAssessment':
                            response = await this.handleVulnerabilityAssessment(message);
                            break;
                        case 'malwareAnalysis':
                            response = await this.handleMalwareAnalysis(message);
                            break;
                        case 'networkSecurity':
                            response = await this.handleNetworkSecurity(message);
                            break;
                        case 'forensics':
                            response = await this.handleForensics(message);
                            break;
                        case 'threatIntel':
                            response = await this.handleThreatIntel(message);
                            break;
                        case 'codeAudit':
                            response = await this.handleCodeAudit(message);
                            break;
                        case 'imageGeneration':
                            response = await this.handleImageGeneration(message);
                            break;
                        case 'webSearch':
                            response = await this.handleWebSearch(message);
                            break;
                        default:
                            response = await this.handleGeneralCybersecurity(message);
                    }

                    await this.typeMessage(response);
                    this.saveToHistory(response, 'assistant');
                    
                } catch (error) {
                    console.error('Error processing message:', error);
                    await this.typeMessage("I encountered an error processing your cybersecurity request. Please try again or contact your security administrator.");
                }

                const endTime = performance.now();
                this.stopProcessingTimer(endTime - startTime);
                this.isProcessing = false;
                
                // Clear uploaded files
                this.uploadedFiles = [];
                this.updateUploadedFilesDisplay();
            }

            async handleWebSearch(query) {
                try {
                    // Show enhanced search indicator
                    this.showSearchIndicator();
                    
                    // Simulate search steps
                    for (let i = 0; i < this.searchSteps.length; i++) {
                        document.getElementById('searchText').textContent = this.searchSteps[i];
                        await this.delay(800);
                    }
                    
                    this.hideSearchIndicator();
                    
                    // Enhanced search query for cybersecurity
                    const cyberQuery = this.enhanceCyberQuery(query);
                    const searchUrl = `https://text.pollinations.ai/${encodeURIComponent(cyberQuery)}?model=searchgpt`;
                    
                    const response = await fetch(searchUrl);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    const searchResults = await response.text();
                    
                    return `ðŸ” **Cybersecurity Intelligence Search Results**

**Query:** "${query}"

${searchResults}

<div style="background: var(--tertiary-bg); padding: 12px; border-radius: 8px; margin-top: 16px; border-left: 4px solid var(--accent-color);">
    <i class="fas fa-shield-alt" style="color: var(--accent-color);"></i> 
    <strong>Security Note:</strong> Information compiled from multiple threat intelligence sources and security databases.
</div>`;
                    
                } catch (error) {
                    this.hideSearchIndicator();
                    console.error('Cybersecurity search error:', error);
                    return await this.handleGeneralCybersecurity(`Please provide cybersecurity information about: ${query}`);
                }
            }

            showSearchIndicator() {
                const indicator = document.getElementById('searchIndicator');
                const chatContainer = document.getElementById('chatContainer');
                indicator.classList.add('active');
                chatContainer.appendChild(indicator);
                this.scrollToBottom();
            }

            hideSearchIndicator() {
                const indicator = document.getElementById('searchIndicator');
                indicator.classList.remove('active');
            }

            enhanceCyberQuery(query) {
                return `${query} cybersecurity threat intelligence vulnerability assessment security analysis`;
            }

            async handleVulnerabilityAssessment(message) {
                const prompt = `${this.systemPrompt}

As a vulnerability assessment specialist, analyze this request: "${message}"

Provide a comprehensive vulnerability assessment including:
1. Threat vectors and attack surfaces
2. Common vulnerabilities and exposures (CVEs)
3. Risk prioritization matrix
4. Mitigation strategies
5. Recommended security controls

Focus on actionable intelligence and compliance frameworks.`;

                return await this.callCyberAPI(prompt, 'pentest-specialist');
            }

            async handleMalwareAnalysis(message) {
                const prompt = `${this.systemPrompt}

As a malware analysis expert, address this request: "${message}"

Provide detailed malware analysis including:
1. Malware classification and family identification
2. Behavioral analysis and IOCs (Indicators of Compromise)
3. Attack vector analysis
4. Impact assessment and damage potential
5. Detection signatures and prevention methods
6. Threat attribution if possible

Use industry-standard analysis methodologies.`;

                return await this.callCyberAPI(prompt, 'threat-intel');
            }

            async handleNetworkSecurity(message) {
                const prompt = `${this.systemPrompt}

As a network security specialist, analyze: "${message}"

Cover network security aspects:
1. Network architecture security assessment
2. Traffic analysis and anomaly detection
3. Firewall rules and access control evaluation
4. Intrusion detection/prevention strategies
5. Network segmentation recommendations
6. Monitoring and logging best practices

Provide technical implementation details.`;

                return await this.callCyberAPI(prompt, 'cybersec-advanced');
            }

            async handleForensics(message) {
                const prompt = `${this.systemPrompt}

As a digital forensics investigator, handle: "${message}"

Provide forensic analysis including:
1. Evidence acquisition and preservation procedures
2. Timeline reconstruction methodology
3. Artifact analysis and data recovery
4. Chain of custody requirements
5. Investigation reporting standards
6. Legal and compliance considerations

Follow industry forensic standards and best practices.`;

                return await this.callCyberAPI(prompt, 'cybersec-advanced');
            }

            async handleThreatIntel(message) {
                const prompt = `${this.systemPrompt}

As a threat intelligence analyst, process: "${message}"

Deliver threat intelligence including:
1. Current threat landscape analysis
2. APT (Advanced Persistent Threat) activity
3. Threat actor attribution and TTPs
4. IOCs and threat signatures
5. Predictive threat modeling
6. Strategic intelligence recommendations

Include MITRE ATT&CK framework references where applicable.`;

                return await this.callCyberAPI(prompt, 'threat-intel');
            }

            async handleCodeAudit(message) {
                const prompt = `${this.systemPrompt}

As a secure code review specialist, analyze: "${message}"

Perform comprehensive code security audit:
1. Static application security testing (SAST)
2. Common vulnerability patterns (OWASP Top 10)
3. Secure coding practices evaluation
4. Input validation and sanitization review
5. Authentication and authorization flaws
6. Cryptographic implementation analysis

Provide specific remediation guidance with secure code examples.`;

                const response = await this.callCyberAPI(prompt, 'secure-code');
                
                // Ensure proper code highlighting
                return this.formatCodeResponse(response);
            }

            formatCodeResponse(response) {
                // Enhanced code formatting with proper language detection
                const codeBlockRegex = /```[\s\S]*?```/g;
                
                return response.replace(codeBlockRegex, (match) => {
                    let content = match.slice(3, -3).trim();
                    let language = '';
                    
                    // Detect programming language
                    if (content.includes('function') || content.includes('const') || content.includes('let')) {
                        language = 'javascript';
                    } else if (content.includes('def ') || content.includes('import ')) {
                        language = 'python';
                    } else if (content.includes('<html>') || content.includes('<div>')) {
                        language = 'html';
                    } else if (content.includes('SELECT') || content.includes('INSERT')) {
                        language = 'sql';
                    } else if (content.includes('#include') || content.includes('int main')) {
                        language = 'c';
                    } else if (content.includes('<?php') || content.includes('$_')) {
                        language = 'php';
                    } else if (content.includes('public class') || content.includes('import java')) {
                        language = 'java';
                    }
                    
                    return `\`\`\`${language}\n${content}\n\`\`\``;
                });
            }

            async handleImageGeneration(message) {
                try {
                    const cyberPrompt = this.enhanceImagePrompt(message);
                    const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(cyberPrompt)}?width=1024&height=1024&model=flux&enhance=true&nologo=true`;
                    
                    return `ðŸŽ¨ **Cybersecurity Visualization Generated**

<img src="${imageUrl}" alt="Cybersecurity Diagram" style="max-width:100%; border-radius:12px; border: 2px solid var(--accent-color); box-shadow: 0 8px 32px rgba(255, 107, 107, 0.3);">

**Generated for:** "${message}"

<div style="background: var(--tertiary-bg); padding: 12px; border-radius: 8px; margin-top: 16px;">
    <i class="fas fa-palette" style="color: var(--accent-secondary);"></i> 
    <strong>Visual Intelligence:</strong> High-quality cybersecurity diagram generated with enhanced security visualization techniques.
</div>`;
                    
                } catch (error) {
                    console.error('Image generation error:', error);
                    return "I encountered an error generating the cybersecurity visualization. Please try with a more specific description of the security diagram you need.";
                }
            }

            enhanceImagePrompt(originalPrompt) {
                return `${originalPrompt} cybersecurity professional diagram network security visualization high-tech interface dark theme red accents`;
            }

            async handleGeneralCybersecurity(message) {
                const prompt = `${this.systemPrompt}

User inquiry: "${message}"`;

                return await this.callCyberAPI(prompt, 'cybersec-advanced');
            }

            async callCyberAPI(prompt, model = 'cybersec-advanced') {
                try {
                    // Simulate different API endpoints for different models
                    let apiUrl;
                    
                    switch (model) {
                        case 'pentest-specialist':
                        case 'threat-intel':
                        case 'secure-code':
                        case 'cybersec-advanced':
                            apiUrl = `https://text.pollinations.ai/${encodeURIComponent(prompt)}?model=openai`;
                            break;
                        default:
                            apiUrl = `https://text.pollinations.ai/${encodeURIComponent(prompt)}?model=openai`;
                    }
                    
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    return await response.text();
                } catch (error) {
                    console.error('Cybersecurity API call failed:', error);
                    throw error;
                }
            }

            triggerWebSearch() {
                const userInput = document.getElementById('userInput');
                const currentValue = userInput.value.trim();
                
                if (currentValue) {
                    userInput.value = `Search for cybersecurity threat intelligence about: ${currentValue}`;
                } else {
                    userInput.value = "Search for the latest cybersecurity threats and vulnerabilities";
                }
                
                userInput.focus();
            }

            triggerVulnerabilityAssessment() {
                const userInput = document.getElementById('userInput');
                userInput.value = "Perform a vulnerability assessment and provide security recommendations";
                userInput.focus();
            }

            triggerImageGeneration() {
                const userInput = document.getElementById('userInput');
                const currentValue = userInput.value.trim();
                
                if (currentValue) {
                    userInput.value = `Create a cybersecurity diagram for: ${currentValue}`;
                } else {
                    userInput.value = "Generate a network security architecture diagram";
                }
                
                userInput.focus();
            }

            triggerMalwareAnalysis() {
                const userInput = document.getElementById('userInput');
                userInput.value = "Analyze this malware sample and provide threat intelligence";
                userInput.focus();
            }

            showChatInterface() {
                const mainContent = document.getElementById('mainContent');
                const chatContainer = document.getElementById('chatContainer');
                
                mainContent.style.display = 'none';
                chatContainer.style.display = 'flex';
            }

            addMessage(text, isUser = false) {
                const chatContainer = document.getElementById('chatContainer');
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message', isUser ? 'user-message' : 'bot-message');

                if (text.includes('```')) {
                    this.renderEnhancedCodeBlocks(messageDiv, text);
                } else {
                    messageDiv.innerHTML = text;
                }

                chatContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }

            renderEnhancedCodeBlocks(container, text) {
                const parts = text.split(/(```[\s\S]*?```)/g);

                parts.forEach(part => {
                    if (part.startsWith('```') && part.endsWith('```')) {
                        let codeContent = part.slice(3, -3).trim();
                        let lines = codeContent.split('\n');
                        let language = '';

                        // Enhanced language detection
                        if (lines[0].trim().match(/^(javascript|js|python|py|html|css|sql|java|cpp|c\+\+|php|ruby|go|rust|bash|shell|json|xml|yaml)$/i)) {
                            language = lines[0].trim().toLowerCase();
                            lines.shift();
                        } else {
                            // Auto-detect language
                            const content = lines.join('\n');
                            if (content.includes('function') || content.includes('const') || content.includes('=>')) {
                                language = 'javascript';
                            } else if (content.includes('def ') || content.includes('import ')) {
                                language = 'python';
                            } else if (content.includes('<') && content.includes('>')) {
                                language = 'html';
                            } else if (content.includes('SELECT') || content.includes('INSERT')) {
                                language = 'sql';
                            }
                        }

                        const codeContainer = document.createElement('div');
                        codeContainer.className = 'code-container';

                        const codeHeader = document.createElement('div');
                        codeHeader.className = 'code-header';
                        codeHeader.innerHTML = `
                            <span class="code-language">${language || 'code'}</span>
                            <button class="copy-btn" onclick="this.copyCode()">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        `;

                        const pre = document.createElement('pre');
                        const code = document.createElement('code');
                        code.className = `language-${language}`;
                        code.textContent = lines.join('\n');
                        pre.appendChild(code);

                        // Add copy functionality
                        const copyBtn = codeHeader.querySelector('.copy-btn');
                        copyBtn.copyCode = () => {
                            navigator.clipboard.writeText(code.textContent).then(() => {
                                const originalText = copyBtn.innerHTML;
                                copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                                copyBtn.style.background = 'var(--accent-secondary)';
                                setTimeout(() => {
                                    copyBtn.innerHTML = originalText;
                                    copyBtn.style.background = 'var(--accent-color)';
                                }, 2000);
                            });
                        };

                        codeContainer.appendChild(codeHeader);
                        codeContainer.appendChild(pre);
                        container.appendChild(codeContainer);

                        hljs.highlightElement(code);
                    } else {
                        const span = document.createElement('span');
                        span.innerHTML = part;
                        container.appendChild(span);
                    }
                });
            }
renderEnhancedContent(container, text) {
    // Handle complex content with code blocks, images, and HTML
    if (text.includes('```')) {
        this.renderEnhancedCodeBlocks(container, text);
    } else {
        container.innerHTML = text;
    }
}
            async typeMessage(text) {
                // Show typing indicator
                const typingIndicator = document.getElementById('typingIndicator');
                const chatContainer = document.getElementById('chatContainer');
                
                if (typingIndicator && chatContainer) {
                    typingIndicator.classList.add('active');
                    chatContainer.appendChild(typingIndicator);
                    this.scrollToBottom();
                    
                    await this.delay(1500); // Longer delay for more realistic typing
                    
                    typingIndicator.classList.remove('active');
                }

                // Create message container
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message', 'bot-message');
                chatContainer.appendChild(messageDiv);

                // Enhanced typing animation
                if (text.includes('```') || text.includes('<img') || text.includes('<div')) {
                    // For complex content, render immediately
                    this.renderEnhancedContent(messageDiv, text);
                } else {
                    // Type out simple text with enhanced animation
                    let currentText = '';
                    const words = text.split(' ');
                    
                    for (let i = 0; i < words.length; i++) {
                        currentText += words[i] + ' ';
                        messageDiv.innerHTML = currentText;
                        this.scrollToBottom();
                        
                        // Variable delay based on word length and content
                        const delay = words[i].length > 6 ? 80 : 
                                     words[i].includes('.') || words[i].includes('!') ? 150 : 
                                     50;
                        await this.delay(delay);
                    }
                }

                this.scrollToBottom();
            }


            startProcessingTimer() {
                const sendIcon = document.getElementById('sendIcon');
                const sendCounter = document.getElementById('sendCounter');
                
                sendIcon.style.opacity = "0";
                sendCounter.classList.add('active');
                sendCounter.textContent = "0.0";

                const startTime = performance.now();
                this.timerInterval = setInterval(() => {
                    const elapsed = (performance.now() - startTime) / 1000;
                    sendCounter.textContent = elapsed.toFixed(1);
                }, 100);
            }

            stopProcessingTimer(duration) {
                const sendIcon = document.getElementById('sendIcon');
                const sendCounter = document.getElementById('sendCounter');
                
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }
                
                const total = (duration / 1000).toFixed(1);
                sendCounter.textContent = total + "s";

                setTimeout(() => {
                    sendCounter.classList.remove('active');
                    sendIcon.style.opacity = "1";
                }, 1200);
            }

            saveToHistory(message, sender) {
                const timestamp = new Date().toISOString();
                const historyItem = {
                    message,
                    sender,
                    timestamp,
                    model: this.currentModel
                };
                
                this.chatHistory.push(historyItem);
                
                // Save to localStorage
                let allHistory = JSON.parse(localStorage.getItem('pikAI_chatHistory') || '[]');
                allHistory.push(historyItem);
                
                if (allHistory.length > 1000) {
                    allHistory = allHistory.slice(-1000);
                }
                
                localStorage.setItem('pikAI_chatHistory', JSON.stringify(allHistory));
                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const historyList = document.getElementById('historyList');
                const history = JSON.parse(localStorage.getItem('pikAI_chatHistory') || '[]');
                
                const groupedHistory = this.groupHistoryByDate(history);
                
                historyList.innerHTML = Object.entries(groupedHistory).map(([date, messages]) => `
                    <div class="history-item">
                        <div style="font-weight: 600; margin-bottom: 8px;">${date}</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">
                            ${messages.length} messages
                        </div>
                    </div>
                `).join('');
            }

            groupHistoryByDate(history) {
                const grouped = {};
                history.forEach(item => {
                    const date = new Date(item.timestamp).toDateString();
                    if (!grouped[date]) {
                        grouped[date] = [];
                    }
                    grouped[date].push(item);
                });
                return grouped;
            }

            loadSidebarData() {
                this.updateHistoryDisplay();
                // Load other sidebar data (projects, library) from localStorage or API
            }

            setupDragAndDrop() {
                const fileUploadArea = document.getElementById('fileUploadArea');

                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    document.body.addEventListener(eventName, this.preventDefaults, false);
                });

                ['dragenter', 'dragover'].forEach(eventName => {
                    document.body.addEventListener(eventName, () => {
                        fileUploadArea.style.display = 'block';
                        fileUploadArea.classList.add('dragover');
                    }, false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    document.body.addEventListener(eventName, () => {
                        fileUploadArea.classList.remove('dragover');
                        setTimeout(() => {
                            fileUploadArea.style.display = 'none';
                        }, 100);
                    }, false);
                });

                document.body.addEventListener('drop', (e) => {
                    const files = Array.from(e.dataTransfer.files);
                    if (files.length > 0) {
                        this.processFiles(files);
                    }
                }, false);
            }

            preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            async handleFileUpload(event) {
                const files = Array.from(event.target.files);
                await this.processFiles(files);
            }

            async processFiles(files) {
                for (const file of files) {
                    if (file.size > this.maxFileSize) {
                        this.addMessage(`File "${file.name}" is too large. Maximum size is ${this.formatFileSize(this.maxFileSize)}.`, false);
                        continue;
                    }
                    
                    this.uploadedFiles.push(file);
                }
                
                this.updateUploadedFilesDisplay();
                
                if (files.length > 0) {
                    this.addMessage(`ðŸ“Ž Uploaded ${files.length} file(s) for cybersecurity analysis.`, false);
                }
            }

            updateUploadedFilesDisplay() {
                const container = document.getElementById('uploadedFiles');
                if (!this.uploadedFiles.length) {
                    container.innerHTML = '';
                    return;
                }

                container.innerHTML = this.uploadedFiles.map((file, index) => `
                    <div class="file-chip">
                        <i class="fas fa-file-alt"></i>
                        <span>${file.name} (${this.formatFileSize(file.size)})</span>
                        <span class="remove-btn" onclick="window.pikAI.removeFile(${index})">Ã—</span>
                    </div>
                `).join('');
            }

            removeFile(index) {
                this.uploadedFiles.splice(index, 1);
                this.updateUploadedFilesDisplay();
            }

            formatFileSize(bytes) {
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                if (bytes === 0) return '0 Bytes';
                const i = Math.floor(Math.log(bytes) / Math.log(1024));
                return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
            }

            setupFileUpload() {
                const fileUploadArea = document.getElementById('fileUploadArea');
                const hiddenFileInput = document.getElementById('hiddenFileInput');
                
                fileUploadArea?.addEventListener('click', () => hiddenFileInput?.click());
            }

            scrollToBottom() {
                const chatContainer = document.getElementById('chatContainer');
                if (chatContainer) {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
            }

            scrollToTop() {
                const chatContainer = document.getElementById('chatContainer');
                if (chatContainer) {
                    chatContainer.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                }
            }

            loadUserSettings() {
                // Load user preferences from localStorage
                const savedUsername = localStorage.getItem('pikAI_username');
                if (savedUsername) {
                    this.currentUsername = savedUsername;
                    document.getElementById('usernameDisplay').textContent = savedUsername;
                    document.getElementById('popupOverlay').classList.add('hidden');
                }
            }

            updateGreeting() {
                const greetingElement = document.getElementById('greetingText');
                const now = new Date();
                const hour = now.getHours();
                let greeting = "";

                if (hour >= 5 && hour < 12) {
                    greeting = "Good morning,";
                } else if (hour >= 12 && hour < 17) {
                    greeting = "Good afternoon,";
                } else if (hour >= 17 && hour < 21) {
                    greeting = "Good evening,";
                } else {
                    greeting = "Working late,";
                }

                if (greetingElement) {
                    greetingElement.textContent = greeting;
                }
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Global functions
        function updateSystemPrompt() {
            const newPrompt = document.getElementById('systemPromptEditor').value.trim();
            if (newPrompt) {
                window.pikAI.systemPrompt = newPrompt;
                localStorage.setItem('pikAI_systemPrompt', newPrompt);
                
                // Show confirmation
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Updated!';
                button.style.background = 'var(--accent-secondary)';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = 'var(--accent-color)';
                }, 2000);
            }
        }

        function submitName() {
            const input = document.getElementById('username').value.trim();
            if (input !== "") {
                window.pikAI.currentUsername = input;
                document.getElementById('usernameDisplay').textContent = input;
                localStorage.setItem('pikAI_username', input);

                document.getElementById('popupBox').classList.add("hidden");
                document.getElementById('popupOverlay').classList.add("hidden");
            }
        }

        // Initialize PikAI system
        document.addEventListener('DOMContentLoaded', () => {
            window.pikAI = new AdvancedPikAI();
            console.log('ðŸ›¡ï¸ PikAI Cybersecurity System Initialized');
            
            // Load saved system prompt
            const savedPrompt = localStorage.getItem('pikAI_systemPrompt');
            if (savedPrompt) {
                window.pikAI.systemPrompt = savedPrompt;
                document.getElementById('systemPromptEditor').value = savedPrompt;
            }
        });

        // Enhanced error handling
        window.addEventListener('error', (error) => {
            console.error('ðŸš¨ System error detected:', error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('ðŸš¨ Unhandled security exception:', event.reason);
        });

        // Security-focused keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Shift + S for security scan
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                document.getElementById('vulnerabilityBtn')?.click();
            }
            
            // Ctrl/Cmd + Shift + M for malware analysis
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'M') {
                e.preventDefault();
                document.getElementById('malwareBtn')?.click();
            }
            
            // Esc to close sidebar
            if (e.key === 'Escape') {
                window.pikAI?.closeSidebar();
            }
        });
    </script>
</body>
</html>
